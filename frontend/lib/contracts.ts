import { parseAbi } from "viem";

// Contract ABI for UZRLeverage
// Using parseAbi with constructor for deployment
export const UZRLeverageABI = [
  {
    type: "constructor",
    inputs: [{ name: "user_", type: "address" }],
    stateMutability: "nonpayable",
  },
  ...parseAbi([
    "function leveragePosition(uint256 iterations) external",
    "function unleveragePosition(uint256 iterations) external",
    "function user() external view returns (address)",
    "function lendingMarket() external view returns (address)",
    "function busd0() external view returns (address)",
    "function usd0() external view returns (address)",
    "function poolFee() external pure returns (uint24)",
    "function emergencyWithdraw(address token, uint256 amount) external",
  ]),
] as const;

// Contract ABI for ILendingMarket (minimal interface)
// Using full ABI format because parseAbi doesn't support tuples
export const LendingMarketABI = [
  {
    name: "getUserPosition",
    type: "function",
    stateMutability: "view",
    inputs: [
      {
        name: "marketParams",
        type: "tuple",
        components: [
          { name: "loanToken", type: "address" },
          { name: "collateralToken", type: "address" },
          { name: "oracle", type: "address" },
          { name: "irm", type: "address" },
          { name: "ltv", type: "uint256" },
          { name: "lltv", type: "uint256" },
          { name: "whitelist", type: "address" },
        ],
      },
      { name: "user", type: "address" },
    ],
    outputs: [
      { name: "supplyAssets", type: "uint256" },
      { name: "supplyShares", type: "uint256" },
      { name: "borrowAssets", type: "uint256" },
      { name: "borrowShares", type: "uint256" },
      { name: "collateralAssets", type: "uint256" },
    ],
  },
  {
    name: "setAuthorization",
    type: "function",
    stateMutability: "nonpayable",
    inputs: [
      { name: "authorized", type: "address" },
      { name: "newIsAuthorized", type: "bool" },
    ],
    outputs: [],
  },
  {
    name: "isAuthorized",
    type: "function",
    stateMutability: "view",
    inputs: [
      { name: "user", type: "address" },
      { name: "authorized", type: "address" },
    ],
    outputs: [{ name: "", type: "bool" }],
  },
] as const;

// Contract ABI for ERC20
export const ERC20ABI = parseAbi([
  "function balanceOf(address account) external view returns (uint256)",
  "function allowance(address owner, address spender) external view returns (uint256)",
  "function approve(address spender, uint256 amount) external returns (bool)",
  "function transfer(address to, uint256 amount) external returns (bool)",
]);

// Contract addresses (Mainnet)
export const CONTRACT_ADDRESSES = {
  UZR_LENDING_MARKET: "0xa428723eE8ffD87088C36121d72100B43F11fb6A" as const,
  BUSD0: "0x35D8949372D46B7a3D5A56006AE77B215fc69bC0" as const,
  USD0: "0x73A15FeD60Bf67631dC6cd7Bc5B6e8da8190aCF5" as const,
} as const;


// Market params structure
export const MARKET_PARAMS = {
  loanToken: CONTRACT_ADDRESSES.USD0,
  collateralToken: CONTRACT_ADDRESSES.BUSD0,
  oracle: "0x30Da78355FcEA04D1fa34AF3c318BE203C6F2145",
  irm: "0xdfCF197B0B65066183b04B88d50ACDC0C4b01385",
  ltv: BigInt("880000000000000000"), // 0.88 (88%)
  lltv: BigInt("999900000000000000"), // 0.9999
  whitelist: "0xFE7C47895eDb12a990b311Df33B90Cfea1D44c24",
} as const;

// UZRLeverage bytecode (this would need to be compiled from the contract)
// For now, we'll use a placeholder - in production, compile the contract and include the bytecode
export const UZRLeverageBytecode = "0x5f80546001600160a01b03199081166e22d473030f116ddee9f6b43ac78ba39081179092556001805482169092179091556002805482167366a9893cc07d91d95644aedd05d03f95e1dba8af17905573a428723ee8ffd87088c36121d72100b43f11fb6a6080526101e06040527373a15fed60bf67631dc6cd7bc5b6e8da8190acf56101008190527335d8949372d46b7a3d5a56006ae77b215fc69bc06101208190527330da78355fcea04d1fa34af3c318be203c6f214561014081905273dfcf197b0b65066183b04b88d50acdc0c4b01385610160819052670c3663566a580000610180819052670de05bc096e9c0006101a081905273fe7c47895edb12a990b311df33b90cfea1d44c246101c0819052600580548916881790556006805489168717905560078054891686179055600880548916909417909355600991909155600a55600b80549095161790935560a05260c05260e052348015610163575f5ffd5b506040516120ec3803806120ec83398101604081905261018291610476565b600380546001600160a01b0319166001600160a01b038381169190911790915560a05160805160405163095ea7b360e01b815290831660048201525f19602482015291169063095ea7b3906044016020604051808303815f875af11580156101ec573d5f5f3e3d5ffd5b505050506040513d601f19601f8201168201806040525081019061021091906104a3565b5060c05160805160405163095ea7b360e01b81526001600160a01b0391821660048201525f19602482015291169063095ea7b3906044016020604051808303815f875af1158015610263573d5f5f3e3d5ffd5b505050506040513d601f19601f8201168201806040525081019061028791906104a3565b5060a0515f5460405163095ea7b360e01b81526001600160a01b0391821660048201525f19602482015291169063095ea7b3906044016020604051808303815f875af11580156102d9573d5f5f3e3d5ffd5b505050506040513d601f19601f820116820180604052508101906102fd91906104a3565b5060c0515f5460405163095ea7b360e01b81526001600160a01b0391821660048201525f19602482015291169063095ea7b3906044016020604051808303815f875af115801561034f573d5f5f3e3d5ffd5b505050506040513d601f19601f8201168201806040525081019061037391906104a3565b5060015460a0516002546040516387517c4560e01b81526001600160a01b03928316600482015290821660248201526044810182905265ffffffffffff60648201819052928216906387517c45906084015f604051808303815f87803b1580156103db575f5ffd5b505af11580156103ed573d5f5f3e3d5ffd5b505060015460c0516002546040516387517c4560e01b81526001600160a01b0392831660048201529082166024820152858216604482015265ffffffffffff87166064820152911692506387517c4591506084015f604051808303815f87803b158015610458575f5ffd5b505af115801561046a573d5f5f3e3d5ffd5b505050505050506104c2565b5f60208284031215610486575f5ffd5b81516001600160a01b038116811461049c575f5ffd5b9392505050565b5f602082840312156104b3575f5ffd5b8151801515811461049c575f5ffd5b60805160a05160c05160e051611b656105875f395f818161021e01528181610ec101526114c601525f818161017e015281816106a001528181610a0801528181610bf301528181610cc801528181611055015261148101525f818160e8015281816107390152818161081a01528181610ceb0152818161121f01528181611388015261145e01525f8181610157015281816105860152818161092501528181610a9801528181610e5501528181610fbb015281816110f3015261119d0152611b655ff3fe608060405234801561000f575f5ffd5b50600436106100cb575f3560e01c8063732eb16a1161008857806395ccea671161006357806395ccea67146102405780639bcf4512146102535780639e01490d14610266578063e85927a214610279575f5ffd5b8063732eb16a146101795780637b9e68f2146101a05780637dc0d1d014610219575f5ffd5b8063089fe6aa146100cf57806314226364146100e35780632c30e13b146101225780634f8632ba146101375780635bce12d31461014a57806370a5c27414610152575b5f5ffd5b604051606481526020015b60405180910390f35b61010a7f000000000000000000000000000000000000000000000000000000000000000081565b6040516001600160a01b0390911681526020016100da565b61013561013036600461168d565b61028c565b005b60035461010a906001600160a01b031681565b61013561032b565b61010a7f000000000000000000000000000000000000000000000000000000000000000081565b61010a7f000000000000000000000000000000000000000000000000000000000000000081565b600554600654600754600854600954600a54600b546101d4966001600160a01b039081169681169581169481169392911687565b604080516001600160a01b0398891681529688166020880152948716948601949094529185166060850152608084015260a083015290911660c082015260e0016100da565b61010a7f000000000000000000000000000000000000000000000000000000000000000081565b61013561024e3660046116ad565b6103ca565b60045461010a906001600160a01b031681565b6101356102743660046116d5565b610515565b6101356102873660046116d5565b6108b4565b6003546001600160a01b031633146103095760405162461bcd60e51b815260206004820152603560248201527f555a524c657665726167653a206f6e6c792063757272656e742075736572206360448201527430b71031b0b636103a3434b990333ab731ba34b7b760591b60648201526084015b60405180910390fd5b600480546001600160a01b0319166001600160a01b0392909216919091179055565b6004546001600160a01b031633146103a35760405162461bcd60e51b815260206004820152603560248201527f555a524c657665726167653a206f6e6c792070656e64696e672075736572206360448201527430b71031b0b636103a3434b990333ab731ba34b7b760591b6064820152608401610300565b60048054600380546001600160a01b03199081166001600160a01b03841617909155169055565b6003546001600160a01b0316331461041d5760405162461bcd60e51b81526020600482015260166024820152752aad292632bb32b930b3b29d1037b7363c903ab9b2b960511b6044820152606401610300565b6040516370a0823160e01b815230600482015282905f906001600160a01b038316906370a0823190602401602060405180830381865afa158015610463573d5f5f3e3d5ffd5b505050506040513d601f19601f8201168201806040525081019061048791906116ec565b90505f83156104965783610498565b815b9050818111156104f45760405162461bcd60e51b815260206004820152602160248201527f555a524c657665726167653a20696e73756666696369656e742062616c616e636044820152606560f81b6064820152608401610300565b60035461050e906001600160a01b03858116911683610b58565b5050505050565b6003546001600160a01b0316331461053f5760405162461bcd60e51b815260040161030090611703565b5f811161055e5760405162461bcd60e51b815260040161030090611750565b6003546040516332f256cf60e11b81526001600160a01b0391821660048201523060248201527f0000000000000000000000000000000000000000000000000000000000000000909116906365e4ad9e90604401602060405180830381865afa1580156105cd573d5f5f3e3d5ffd5b505050506040513d601f19601f820116820180604052508101906105f19190611793565b6106895760405162461bcd60e51b815260206004820152605e60248201527f555a524c657665726167653a20636f6e7472616374206e6f7420617574686f7260448201527f697a65642e2043616c6c206c656e64696e674d61726b65742e7365744175746860648201527f6f72697a6174696f6e28616464726573732874686973292c2074727565290000608482015260a401610300565b6040516370a0823160e01b81523060048201525f907f00000000000000000000000000000000000000000000000000000000000000006001600160a01b0316906370a0823190602401602060405180830381865afa1580156106ed573d5f5f3e3d5ffd5b505050506040513d601f19601f8201168201806040525081019061071191906116ec565b905080156107225761072281610b8d565b6040516370a0823160e01b81523060048201525f907f00000000000000000000000000000000000000000000000000000000000000006001600160a01b0316906370a0823190602401602060405180830381865afa158015610786573d5f5f3e3d5ffd5b505050506040513d601f19601f820116820180604052508101906107aa91906116ec565b90505f81116107fb5760405162461bcd60e51b815260206004820152601d60248201527f555a524c657665726167653a206e6f2042555344302062616c616e63650000006044820152606401610300565b5f5b838110156108ae576040516370a0823160e01b81523060048201527f00000000000000000000000000000000000000000000000000000000000000006001600160a01b0316906370a0823190602401602060405180830381865afa158015610867573d5f5f3e3d5ffd5b505050506040513d601f19601f8201168201806040525081019061088b91906116ec565b9150670de0b6b3a76400008211156108ae576108a682610e3b565b6001016107fd565b50505050565b6003546001600160a01b031633146108de5760405162461bcd60e51b815260040161030090611703565b5f81116108fd5760405162461bcd60e51b815260040161030090611750565b6003546040516332f256cf60e11b81526001600160a01b0391821660048201523060248201527f0000000000000000000000000000000000000000000000000000000000000000909116906365e4ad9e90604401602060405180830381865afa15801561096c573d5f5f3e3d5ffd5b505050506040513d601f19601f820116820180604052508101906109909190611793565b6109e85760405162461bcd60e51b8152602060048201526024808201527f555a524c657665726167653a20636f6e7472616374206e6f7420617574686f726044820152631a5e995960e21b6064820152608401610300565b5f805b82811015610b53576040516370a0823160e01b81523060048201527f00000000000000000000000000000000000000000000000000000000000000006001600160a01b0316906370a0823190602401602060405180830381865afa158015610a55573d5f5f3e3d5ffd5b505050506040513d601f19601f82011682018060405250810190610a7991906116ec565b600354604051631ac3574d60e01b81529193505f916001600160a01b037f0000000000000000000000000000000000000000000000000000000000000000811692631ac3574d92610ad1926005921690600401611808565b60a060405180830381865afa158015610aec573d5f5f3e3d5ffd5b505050506040513d601f19601f82011682018060405250810190610b10919061182f565b50509250505080831115610b2c57610b2960018261187f565b92505b670de0b6b3a76400008311610b415750505050565b610b4a836110d7565b506001016109eb565b505050565b610b6583838360016112a2565b610b5357604051635274afe760e01b81526001600160a01b0384166004820152602401610300565b5f8111610bdc5760405162461bcd60e51b815260206004820152601d60248201527f555a524c657665726167653a207a65726f207377617020616d6f756e740000006044820152606401610300565b6040516370a0823160e01b81523060048201525f907f00000000000000000000000000000000000000000000000000000000000000006001600160a01b0316906370a0823190602401602060405180830381865afa158015610c40573d5f5f3e3d5ffd5b505050506040513d601f19601f82011682018060405250810190610c6491906116ec565b905081811015610cc55760405162461bcd60e51b815260206004820152602660248201527f555a524c657665726167653a20696e73756666696369656e7420555344302062604482015265616c616e636560d01b6064820152608401610300565b5f7f000000000000000000000000000000000000000000000000000000000000000060647f0000000000000000000000000000000000000000000000000000000000000000604051602001610d1c93929190611898565b60408051601f1981840301815291905290505f3084610d40816103e36103e8611304565b846001604051602001610d57959493929190611901565b60408051808303601f190181528282525f602084018190528251600181860381018252602186018181526061870190955292955093909291906041015b6060815260200190600190039081610d9457905050905082815f81518110610dbe57610dbe611941565b60209081029190910101526002546001600160a01b0316633593564c8383610de84261012c611955565b6040518463ffffffff1660e01b8152600401610e0693929190611968565b5f604051808303815f87803b158015610e1d575f5ffd5b505af1158015610e2f573d5f5f3e3d5ffd5b50505050505050505050565b6003546040516354d4f49360e11b81526001600160a01b037f000000000000000000000000000000000000000000000000000000000000000081169263a9a9e92692610e919260059287929116906004016119e6565b5f604051808303815f87803b158015610ea8575f5ffd5b505af1158015610eba573d5f5f3e3d5ffd5b505050505f7f00000000000000000000000000000000000000000000000000000000000000006001600160a01b031663a035b1fe6040518163ffffffff1660e01b8152600401602060405180830381865afa158015610f1b573d5f5f3e3d5ffd5b505050506040513d601f19601f82011682018060405250810190610f3f91906116ec565b90505f610f5c83836ec097ce7bc90715b34b9f1000000000611304565b90505f610f8a662386f26fc10000600560040154610f7a919061187f565b8390670de0b6b3a7640000611304565b9050670de0b6b3a76400008111610fa15750505050565b600354604051631a70d63560e21b81526001600160a01b037f00000000000000000000000000000000000000000000000000000000000000008116926369c358d492610ffd9260059287925f9291909116903090600401611a20565b60408051808303815f875af1158015611018573d5f5f3e3d5ffd5b505050506040513d601f19601f8201168201806040525081019061103c9190611a5e565b50506040516370a0823160e01b81523060048201525f907f00000000000000000000000000000000000000000000000000000000000000006001600160a01b0316906370a0823190602401602060405180830381865afa1580156110a2573d5f5f3e3d5ffd5b505050506040513d601f19601f820116820180604052508101906110c691906116ec565b9050801561050e5761050e81610b8d565b600354604051639529b18760e01b81525f916001600160a01b037f0000000000000000000000000000000000000000000000000000000000000000811692639529b1879261113092600592889288921690600401611a80565b60408051808303815f875af115801561114b573d5f5f3e3d5ffd5b505050506040513d601f19601f8201168201806040525081019061116f9190611a5e565b5090505f6111808260646058611304565b60035460405163af1beac360e01b81529192506001600160a01b037f000000000000000000000000000000000000000000000000000000000000000081169263af1beac3926111dc926005928792909116903090600401611ac3565b5f604051808303815f87803b1580156111f3575f5ffd5b505af1158015611205573d5f5f3e3d5ffd5b50506040516370a0823160e01b81523060048201525f92507f00000000000000000000000000000000000000000000000000000000000000006001600160a01b031691506370a0823190602401602060405180830381865afa15801561126d573d5f5f3e3d5ffd5b505050506040513d601f19601f8201168201806040525081019061129191906116ec565b905080156108ae576108ae81611322565b60405163a9059cbb60e01b5f8181526001600160a01b038616600452602485905291602083604481808b5af1925060015f511483166112f85783831516156112ec573d5f823e3d81fd5b5f873b113d1516831692505b60405250949350505050565b5f816113108486611af9565b61131a9190611b10565b949350505050565b5f81116113715760405162461bcd60e51b815260206004820152601d60248201527f555a524c657665726167653a207a65726f207377617020616d6f756e740000006044820152606401610300565b6040516370a0823160e01b81523060048201525f907f00000000000000000000000000000000000000000000000000000000000000006001600160a01b0316906370a0823190602401602060405180830381865afa1580156113d5573d5f5f3e3d5ffd5b505050506040513d601f19601f820116820180604052508101906113f991906116ec565b90508181101561145b5760405162461bcd60e51b815260206004820152602760248201527f555a524c657665726167653a20696e73756666696369656e742042555344302060448201526662616c616e636560c81b6064820152608401610300565b5f7f000000000000000000000000000000000000000000000000000000000000000060647f00000000000000000000000000000000000000000000000000000000000000006040516020016114b293929190611898565b60405160208183030381529060405290505f7f00000000000000000000000000000000000000000000000000000000000000006001600160a01b031663a035b1fe6040518163ffffffff1660e01b8152600401602060405180830381865afa158015611520573d5f5f3e3d5ffd5b505050506040513d601f19601f8201168201806040525081019061154491906116ec565b90505f61156185836ec097ce7bc90715b34b9f1000000000611304565b90505f3086611575846103846103e8611304565b86600160405160200161158c959493929190611901565b60408051808303601f190181528282525f602084018190528251600181860381018252602186018181526061870190955292955093909291906041015b60608152602001906001900390816115c957905050905082815f815181106115f3576115f3611941565b60209081029190910101526002546001600160a01b0316633593564c838361161d4261012c611955565b6040518463ffffffff1660e01b815260040161163b93929190611968565b5f604051808303815f87803b158015611652575f5ffd5b505af1158015611664573d5f5f3e3d5ffd5b505050505050505050505050565b80356001600160a01b0381168114611688575f5ffd5b919050565b5f6020828403121561169d575f5ffd5b6116a682611672565b9392505050565b5f5f604083850312156116be575f5ffd5b6116c783611672565b946020939093013593505050565b5f602082840312156116e5575f5ffd5b5035919050565b5f602082840312156116fc575f5ffd5b5051919050565b6020808252602d908201527f555a524c657665726167653a206f6e6c7920757365722063616e2063616c6c2060408201526c3a3434b990333ab731ba34b7b760991b606082015260800190565b60208082526023908201527f555a524c657665726167653a20697465726174696f6e73206d7573742062652060408201526203e20360ec1b606082015260800190565b5f602082840312156117a3575f5ffd5b815180151581146116a6575f5ffd5b80546001600160a01b03908116835260018201548116602084015260028201548116604084015260038201548116606084015260048201546080840152600582015460a08401526006909101541660c090910152565b610100810161181782856117b2565b6001600160a01b039290921660e09190910152919050565b5f5f5f5f5f60a08688031215611843575f5ffd5b5050835160208501516040860151606087015160809097015192989197509594509092509050565b634e487b7160e01b5f52601160045260245ffd5b818103818111156118925761189261186b565b92915050565b606093841b6bffffffffffffffffffffffff19908116825260e89390931b6001600160e81b0319166014820152921b166017820152602b0190565b5f81518084528060208401602086015e5f602082860101526020601f19601f83011685010191505092915050565b60018060a01b038616815284602082015283604082015260a060608201525f61192d60a08301856118d3565b905082151560808301529695505050505050565b634e487b7160e01b5f52603260045260245ffd5b808201808211156118925761189261186b565b606081525f61197a60608301866118d3565b828103602084015280855180835260208301915060208160051b840101602088015f5b838110156119cf57601f198684030185526119b98383516118d3565b602095860195909350919091019060010161199d565b505080945050505050826040830152949350505050565b6119f081856117b2565b60e08101929092526001600160a01b031661010082015261014061012082018190525f9082015261016001919050565b6101608101611a2f82886117b2565b60e08201959095526101008101939093526001600160a01b039182166101208401521661014090910152919050565b5f5f60408385031215611a6f575f5ffd5b505080516020909101519092909150565b611a8a81866117b2565b60e08101939093526101008301919091526001600160a01b031661012082015261016061014082018190525f9082015261018001919050565b6101408101611ad282876117b2565b60e08201949094526001600160a01b03928316610100820152911661012090910152919050565b80820281158282048414176118925761189261186b565b5f82611b2a57634e487b7160e01b5f52601260045260245ffd5b50049056fea26469706673582212200b3eceab528231367e40e4323fe66a0a416186c6af89f4992bf6d05768ff61ec64736f6c634300081e0033" as const;